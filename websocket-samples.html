<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<script type="text/javascript" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
		<script type="text/javascript" src="lib/sprintf.min.js"></script>
	</head>
	<body>
		<pre id="data"></pre>

		<select id="power">
			<option>5</option>
			<option>10</option>
			<option>15</option>
			<option>20</option>
			<option>25</option>
			<option>30</option>
			<option>40</option>
			<option>50</option>
		</select>

		<select id="width">
			<option value="00">narrow</option>
			<option value="16">normal</option>
			<option value="31">wide</option>
		</select>

		<select id="noise_reduction">
			<option value="0">off</option>
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
		</select>

		<script>
			Cat = {
				socket : null,
				init : function () {
					var self = this;
					self.start();
					self.bindEvents();
				},

				bindEvents : function () {
					var self = this;

					$('#power').change(function () {
						self.setPower(+$(this).val());
					});

					$('#width').change(function () {
						self.setWidth(+$(this).val());
					});

					$('#noise_reduction').change(function () {
						self.setNoiseReduction(+$(this).val());
					});
				},

				start : function () {
					var self = this;
					self.socket = new WebSocket("ws://" + location.hostname + ":51234");
					self.socket.onopen = function() {
						console.log('ws.onopen');
					};

					self.socket.onclose = function (e) {
						console.log('ws.onclose', e.code, e.reason);
						setTimeout(function () {
							self.start();
						}, 1000);
					};

					self.socket.onmessage = function (evt) {
						console.log('ws.onmessage', data);
						var data = JSON.parse(evt.data);
						$('#data').text(JSON.stringify(data, null, "    "));
					};

					self.socket.onerror = function (e) {
						console.log('ws.onerror');
					};
				},

				setPower : function (power) {
					var self = this;
					self.socket.send(JSON.stringify({ command : 'power', value : power }));
				},

				setFrequency : function (frequency) {
					var self = this;
					self.socket.send(JSON.stringify({ command : 'frequency', value : frequency }));
				},

				setMode : function (mode) {
					var self = this;
					self.socket.send(JSON.stringify({ command : 'mode', value : mode }));
				},

				setWidth : function (width) {
					var self = this;
					self.socket.send(JSON.stringify({ command : 'width', value : width }));
				},

				setNoiseReduction : function (level) {
					var self = this;
					self.socket.send(JSON.stringify({ command : 'noise_reduction', value : level }));
				}

			};

			$(function(){
				Cat.init();
			});
		</script>
	</body>
</html>
