<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<script type="text/javascript" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
		<script type="text/javascript" src="https://raw.github.com/alexei/sprintf.js/master/src/sprintf.min.js"></script>
	</head>
	<body>
		<pre id="data"></pre>

		<select id="power">
			<option>5</option>
			<option>10</option>
			<option>15</option>
			<option>20</option>
			<option>25</option>
			<option>30</option>
			<option>40</option>
			<option>50</option>
		</select>

		<script>
			Cat = {
				socket : null,
				init : function () {
					var self = this;
					self.start();
					self.bindEvents();
				},

				bindEvents : function () {
					var self = this;

					$('#power').change(function () {
						self.setPower(+$(this).val());
					});
				},

				start : function () {
					var self = this;
					self.socket = new WebSocket("ws://localhost:51234");
					self.socket.onopen = function() {
						console.log('ws.onopen');
					};

					self.socket.onclose = function() {
						console.log('ws.onclose');
						setTimeout(function () {
							self.start();
						}, 1000);
					};

					self.socket.onmessage = function (evt) {
						console.log('ws.onmessage', data);
						var data = JSON.parse(evt.data);
						$('#data').text(JSON.stringify(data, null, "    "));
					};
				},

				setPower : function (power) {
					var self = this;
					self.socket.send(JSON.stringify({ command : 'power', value : power }));
				},

				setFrequency : function (frequency) {
					var self = this;
					self.socket.send(JSON.stringify({ command : 'frequency', value : frequency }));
				},

				setMode : function (mode) {
					var self = this;
					self.socket.send(JSON.stringify({ command : 'mode', value : mode }));
				}
			};

			$(function(){
				Cat.init();
			});
		</script>
	</body>
</html>
